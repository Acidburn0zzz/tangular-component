<style>.hidden{display:none}.ui-selectbox *{box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.ui-selectbox{border:1px solid #E0E0E0;font-size:14px;color:black}.ui-selectbox ul{list-style-type:none;width:50%;height:100%;float:left;overflow:auto;margin:0;padding:0;border-left:1px solid #E0E0E0;font-weight:bold;overflow-scrolling:touch;-webkit-overflow-scrolling:touch;-moz-overflow-scrolling:touch;-ms-overflow-scrolling:touch}.ui-selectbox ul:first-child{border-left:0;font-weight:normal}.ui-selectbox li{border-bottom:1px solid #E0E0E0;padding:5px 10px;cursor:pointer;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ui-selectbox li:hover{background-color:#F0F0F0}.ui-selectbox-selected{color:#A0A0A0}.ui-selectbox-search{border-bottom:1px solid #E0E0E0;height:34px;background-color:white}.ui-selectbox-search input{width:100%;outline:0;background-color:white;font:normal normal 12px Arial;border:0;margin:0;padding:0}.ui-selectbox-search span{float:left;width:30px;text-align:center;height:30px;padding:10px 0 0 0;font-size:12px;color:#A0A0A0}.ui-selectbox-search .fa-times{color:red;cursor:pointer}.ui-selectbox-search div{margin-left:30px;padding:8px 10px 0 0}.ui-selectbox-invalid{border-color:#E1A1A1;background-color:#FFF3F3 !important}.ui-selectbox-invalid .ui-selectbox-search{border-color:#E1A1A1}.ui-selectbox.ui-disabled input{background-color:#F0F0F0;color:gray}.ui-selectbox.ui-disabled .ui-selectbox-search{background-color:#F0F0F0}.ui-selectbox.ui-disabled ul{color:gray;overflow:hidden}.ui-selectbox.ui-disabled li:hover{background-color:white !important}</style>
<script>COMPONENT('selectbox',function(self,config){var Eitems,Eselected,datasource=null;self.datasource=EMPTYARRAY;self.template=Tangular.compile('<li data-search="{{ search}}" data-index="{{ index}}">{{ text}}</li>');self.validate=function(value){return config.disabled||!config.required?true:value&&value.length>0};self.configure=function(key,value,init){if(init)return;var redraw=false;switch(key){case'type':self.type=value;break;case'disabled':self.tclass('ui-disabled',value);self.find('input').prop('disabled',value);if(value)self.rclass('ui-selectbox-invalid');else if(config.required)self.state(1,1);break;case'required':!value&&self.state(1,1);break;case'height':case'search':redraw=true;break;case'items':var arr=[];value.split(',').forEach(function(item){item=item.trim().split('|');var obj={};obj.name=item[0].trim();obj.id=(item[1]==null?item[0]:item[1]).trim();if(config.type==='number')obj.id=+obj.id;arr.push(obj)});self.bind('',arr);break;case'datasource':datasource&&self.unwatch(datasource,self.bind);self.watch(value,self.bind,true);datasource=value;break}redraw&&self.redraw()};self.search=function(){var search=config.search?self.find('input').val().toSearch():'';Eitems.find('li').each(function(){var el= $(this);el.tclass('hidden',el.attrd('search').indexOf(search)===-1)});self.find('.ui-selectbox-search-icon').tclass('fa-search',search.length===0).tclass('fa-times',search.length>0)};self.redraw=function(){self.html((typeof(config.search)==='string'?'<div class="ui-selectbox-search"><span><i class="fa fa-search ui-selectbox-search-icon"></i></span><div><input type="text" placeholder="{0}" /></div></div><div>'.format(config.search):'')+'<div style="height:{0}px"><ul></ul><ul style="height:{0}px"></ul></div>'.format(config.height||'200'));self.find('ul').each(function(index){if(index)Eselected= $(this);else Eitems= $(this)})};self.bind=function(path,value){var kt=config.text||'name';var kv=config.value||'id';var builder=[];self.datasource=[];value&&value.forEach(function(item,index){var text;var value;if(typeof(item)==='string'){text=item;value=self.parser(item)}else{text=item[kt];value=item[kv]}var item={text:text,value:value,index:index,search:text.toSearch()};self.datasource.push(item);builder.push(self.template(item))});self.search();Eitems.empty().append(builder.join(''))};self.make=function(){self.aclass('ui-selectbox');self.redraw();config.datasource&&self.reconfigure('datasource:'+config.datasource);config.items&&self.reconfigure('items:'+config.items);self.event('click','li',function(){if(config.disabled)return;var selected=self.get()||[];var index=+this.getAttribute('data-index');var value=self.datasource[index];if(selected.indexOf(value.value)===-1)selected.push(value.value);else selected=selected.remove(value.value);self.set(selected);self.change(true)});self.event('click','.fa-times',function(){if(config.disabled)return;self.find('input').val('');self.search()});typeof(config.search)==='string'&&self.event('keydown','input',function(){if(config.disabled)return;setTimeout2(self.id,self.search,500)})};self.setter=function(value){var selected={};var builder=[];var ds=self.datasource;var dsl=ds.length;if(value){for(var i=0,length=value.length;i<length;i++){for(var j=0;j<dsl;j++){if(ds[j].value===value[i]){selected[j]=true;builder.push(self.template(ds[j]))}}}}Eitems.find('li').each(function(){var el= $(this);var index=+el.attrd('index');el.tclass('ui-selectbox-selected',selected[index]!==undefined)});Eselected.empty().append(builder.join(''));self.search()};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass('ui-selectbox-invalid',invalid)}});</script>