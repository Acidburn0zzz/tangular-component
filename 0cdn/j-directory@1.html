<style>.ui-directory{position:absolute;opacity:0;filter:alpha(opacity=0);transition:0.25s transform cubic-bezier(0.23,1,0.32,1);-webkit-transition:0.25s transform cubic-bezier(0.23,1,0.32,1);-moz-transition:0.25s transform cubic-bezier(0.23,1,0.32,1);-ms-transition:0.25s transform cubic-bezier(0.23,1,0.32,1);left:-100;top:-100;z-index:100;box-shadow:0 1px 20px rgba(0,0,0,0.1);background-color:white;border-radius:3px;border:1px solid #E0E0E0;overflow:hidden}.ui-directory-search{height:38px;background:white;border-radius:3px 3px 0 0;border-bottom:1px solid #E0E0E0;line-height:22px}.ui-directory-search input{width:100%;background-color:white;border:0;font-size:12px;outline:0;padding:0;margin:0;line-height:16px;outline:0}.ui-directory-search > div{margin:0 20px 0 35px;padding:6px 10px 0 0;line-height:24px}.ui-directory-search > span{float:left;width:16px;text-align:center;padding:8px 0 0 12px;font-size:12px}.ui-directory-add{float:right !important;padding-left:0 !important;color:gray;text-align:left !important;font-size:11px !important;cursor:pointer;width:22px !important}.ui-directory-add:hover{color:black}.ui-directory-search .fa-times{color:red;cursor:pointer}.ui-directory-visible{opacity:1;filter:alpha(opacity=100)}.ui-directory-container{height:150px;overflow-x:hidden;overflow-y:auto;overflow-scrolling:touch;-webkit-overflow-scrolling:touch;-moz-overflow-scrolling:touch;-ms-overflow-scrolling:touch;margin:0 30px 0 0;padding:0}.ui-directory ul{list-style-type:none;margin:0;padding:0}.ui-directory .selected{background-color:#F0F0F0;color:black}.ui-directory li{border-top:1px solid #F0F0F0;font-size:12px;padding:3px 10px;background-color:white;cursor:pointer;margin:0;line-height:16px}.ui-directory li:first-child{border-top:0}.ui-dark .ui-directory{background-color:#303030;border-color:#404040;box-shadow:1px 5px 10px rgba(0,0,0,0.2)}.ui-dark .ui-directory-search{background:#303030}.ui-dark .ui-directory li{background-color:#303030;border-color:#404040}.ui-dark .ui-directory-search{border-bottom-color:#404040}.ui-dark .ui-directory-search input{background-color:#303030}.ui-dark .ui-directory-add:hover{color:white}.ui-dark .ui-directory .selected{background-color:#404040;color:white}</style>
<script>COMPONENT('directory@1','minwidth:200',function(self,config){var cls='ui-directory',cls2='.'+cls,container,timeout,icon,plus,input=null,is=false,selectedindex=0,resultscount=0;Thelpers.ui_directory_helper=function(val){return this.template?(typeof(this.template)==='string'?Tangular.render(this.template,this):this.render(this,val)):self.opt.render?self.opt.render(this,val):val};self.template=Tangular.compile('<li data-index="{{ $.index}}" data-search="{{ name}}" {{ if selected}} class="selected{{ if classname}} {{ classname}}{{ fi}}"{{ else if classname}} class="{{ classname}}"{{ fi}}>{{ name | ui_directory_helper}}</li>');self.readonly();self.singleton();self.nocompile&&self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'placeholder':self.find('input').prop('placeholder',value);break}};self.make=function(){self.aclass(cls+' hidden');self.append('<div class="{1}-search"><span class="{1}-add hidden"><i class="fa fa-plus"></i></span><span class="{1}-button"><i class="fa fa-search"></i></span><div><input type="text" placeholder="{0}" class="{1}-search-input" /></div></div><div class="{1}-container"><ul></ul></div>'.format(config.placeholder,cls));container=self.find('ul');input=self.find('input');icon=self.find(cls2+'-button').find('.fa');plus=self.find(cls2+'-add');self.event('mouseenter mouseleave','li',function(){container.find('li.selected').rclass('selected');$(this).aclass('selected');var arr=container.find('li:visible');for(var i=0;i<arr.length;i++){if($(arr[i]).hclass('selected')){selectedindex=i;break}}});self.event('click',cls2+'-button',function(e){input.val('');self.search();e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-add',function(){if(self.opt.callback){self.opt.callback(input.val(),self.opt.element,true);self.hide()}});self.event('touchstart mousedown','li',function(e){self.opt.callback&&self.opt.callback(self.opt.items[+this.getAttribute('data-index')],self.opt.element);self.hide();e.preventDefault();e.stopPropagation()});var e_click=function(e){is&&!$(e.target).hclass(cls+'-search-input')&&self.hide(0)};var e_resize=function(){is&&self.hide(0)};self.bindedevents=false;self.bindevents=function(){if(!self.bindedevents){$(document).on('click',e_click);$(window).on('resize',e_resize);self.bindedevents=true}};self.unbindevents=function(){if(self.bindedevents){self.bindedevents=false;$(document).off('click',e_click);$(window).off('resize',e_resize)}};self.event('keydown','input',function(e){var o=false;switch(e.which){case 27:o=true;self.hide();break;case 13:o=true;var sel=self.find('li.selected');if(self.opt.callback){if(sel.length)self.opt.callback(self.opt.items[+sel.attrd('index')],self.opt.element);else self.opt.callback(this.value,self.opt.element,true)}self.hide();break;case 38:o=true;selectedindex--;if(selectedindex<0)selectedindex=0;else self.move();break;case 40:o=true;selectedindex++;if(selectedindex>=resultscount)selectedindex=resultscount;else self.move();break}if(o){e.preventDefault();e.stopPropagation()}});self.event('input','input',function(){setTimeout2(self.ID,self.search,100,null,this.value)});var fn=function(){is&&self.hide(1)};self.on('reflow',fn);self.on('scroll',fn);self.on('resize',fn);$(window).on('scroll',fn)};self.move=function(){var counter=0,scroller=container.parent();var h=scroller.height();container.find('li').each(function(){var el=$(this);if(el.hclass('hidden')){el.rclass('selected');return}var is=selectedindex===counter;el.tclass('selected',is);if(is){var t=(h*counter)-h;if((t+h*4)>h)scroller.scrollTop(t-h);else scroller.scrollTop(0)}counter++})};self.search=function(value){if(!self.opt)return;icon.tclass('fa-times',!!value).tclass('fa-search',!value);self.opt.custom&&plus.tclass('hidden',!value);if(!value&&!self.opt.ajax){container.find('li').rclass('hidden');resultscount=self.opt.items?self.opt.items.length:0;selectedindex=0;self.move();return}resultscount=0;selectedindex=0;if(self.opt.ajax){var val=value||'';if(self.ajaxold!==val){self.ajaxold=val;setTimeout2(self.ID,function(val){self.opt.ajax(val,function(items){var builder=[],indexer={};for(var i=0;i<items.length;i++){var item=items[i];indexer.index=i;!item.value&&(item.value=item.name);resultscount++;builder.push(self.template(item,indexer))}self.opt.items=items;container.html(builder);self.move()})},300,null,val)}}else if(value){value=value.toSearch();container.find('li').each(function(){var el=$(this);var val=el.attrd('search').toSearch();var is=val.indexOf(value)===-1;el.tclass('hidden',is);if(!is)resultscount++});self.move()}};self.show=function(opt){if(!opt.minwidth)opt.minwidth=200;var el=opt.element instanceof jQuery?opt.element[0]:opt.element;if(is){clearTimeout(timeout);if(self.target===el){self.hide(1);return}}self.initializing=true;self.target=el;opt.ajax=null;var element=$(opt.element);var callback=opt.callback,items=opt.items,type=typeof(items);var item;if(type==='function'&&callback){opt.ajax=items;type='';items=null}if(type==='string')items=self.get(items);if(!items&&!opt.ajax){self.hide(0);return}self.bindevents();self.opt=opt;opt.class&&self.aclass(opt.class);input.val('');var builder=[];if(!opt.ajax){var indexer={};for(var i=0;i<items.length;i++){item=items[i];if(typeof(item)==='string')item={name:item};indexer.index=i;!item.value&&(item.value=item.name);builder.push(self.template(item,indexer))}}self.target=element[0];var offset=element.offset();var width=element.width()+(opt.offsetWidth||0);if(opt.minwidth&&width<opt.minwidth)width=opt.minwidth;else if(opt.maxwidth&&width>opt.maxwidth)width=opt.maxwidth;opt.ajaxold=null;plus.aclass('hidden');self.find('input').prop('placeholder',opt.placeholder||config.placeholder);self.find(cls2+'-container').css('width',width+30);container.html(builder);var options={left:offset.left+(opt.offsetX||0),top:offset.top+(opt.offsetY||0),width:width};self.css(options);!isMOBILE&&setTimeout(function(){self.is=false;input.focus()},500);setTimeout(function(){self.initializing=false;is=true;container.parent()[0].scrollTop=0},50);if(is){self.search();return}selectedindex=0;resultscount=items?items.length:0;self.move();self.search();self.rclass('hidden');self.aclass(cls+'-visible',100)};self.hide=function(sleep){if(!is||self.initializing)return;clearTimeout(timeout);timeout=setTimeout(function(){self.is=false;self.unbindevents();self.rclass(cls+'-visible').aclass('hidden');if(self.opt){self.opt.class&&self.rclass(self.opt.class);self.opt=null}is=false},sleep?sleep:100)}});</script>